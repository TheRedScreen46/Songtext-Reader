<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./style.css">
    <title>Songtext Reader</title>
  </head>
  <body>
    <h1>Folder selection</h1>

    <div id="folderSelect">
      <label for="folder">Select folder</label>
      <input type="text" id="folder" onChange="updateList(document.getElementById('folder').value)"/> 
    </div>
    

    <h1>Detected Files</h1>

    <ul id="filelist">
    </ul>
  </body>
</html>
<script>
  const fs = require('fs');

  var output = document.querySelector("ul");
  var appDataPath = process.env.HOME

  fs.readFile(appDataPath + '/Documents/SongtextReader_Data.txt', 'utf8' , (err, data) => {
    if (err) {
      return
    }
    document.getElementById('folder').value = data
    updateList(data)
  })

  function saveScanDirectory(directory){
    try {
      fs.writeFileSync(appDataPath + '/Documents/SongtextReader_Data.txt', directory , 'utf-8')
    } catch(e) {
      alert('Failed to save the save File!')
    }
  }

  function updateList(scanDirectory){
    saveScanDirectory(scanDirectory)
    output.innerHTML = ''
    fs.readdirSync(scanDirectory).forEach(file => {
      var item = document.createElement("li");
      item.setAttribute("onclick", "openFile(this.id)");
      if(file.indexOf('.') > -1){
        item.innerHTML = file;
        item.setAttribute("id", scanDirectory.replace(/ /g, '" "')+ '/'  + file);
      } else{
        item.innerHTML = '/'+file;
        item.setAttribute("id", '"" ' + '"' + scanDirectory + '/'  + file + '"');
        //var image = document.createElement("i")
        //image.setAttribute("class", "fas fa-folder")
        //item.appendChild(image)
      }
      output.appendChild(item);
    });
  }

  function openFile(file){
    var exec = require('child_process').exec;

    exec(getCommandLine() + ' ' + file);
  }

  function getCommandLine() {
   switch (process.platform) { 
      case 'darwin' : return 'open';
      case 'win32' : return 'start';
      case 'win64' : return 'start';
      default : return 'xdg-open';
   }
}
</script>